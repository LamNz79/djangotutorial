
---

# üìò `design-log/DL-02.md`

# DL-02 ‚Äî User Vote Lookup API

## Background
DL-01 requires the BFF to include the current user‚Äôs vote state when fetching
question details. Django exposes vote mutation endpoints but did not expose
a query endpoint for retrieving a user‚Äôs vote for a question.

---

## Problem
There was no Django API to:
- retrieve a user‚Äôs vote
- scoped to a question
- without inferring or duplicating domain logic in the BFF

This blocked DL-01 Phase 2.

---

## Questions and Answers

**Q1: Should the BFF infer user votes from choice data?**  
**A:** No. Vote ownership is domain logic and must remain in Django.

**Q2: Should the endpoint be question-based or choice-based?**  
**A:** Question-based. The BFF aggregates by question.

**Q3: Should unauthenticated requests be allowed?**  
**A:** No. Authentication is required.

**Q4: What response should indicate ‚Äúnot voted‚Äù?**  
**A:** `404`. Absence of a vote is not an error state.

---

## Design

### Endpoint
GET /questions/:id/my-vote/


### Authentication
- Required

### Response (voted)
```json
{
  "choice_id": 3
}
```
### Response (not voted)
```json
404 Not Found
```

## Implementation Plan
### Phase 1

- Implement endpoint as a QuestionViewSet action

- Enforce authentication

### Phase 2

- Query Vote by (user, question)

- Return minimal payload (choice_id)

### Phase 3

- Verify behavior for voted, not voted, and unauthenticated cases
## Examples
### Voted 
```JSON
{
  "choice_id": 2
}

```
### Not vote

```JSON
404 Not Found
```
## Trade-offs
### Pros

- Clear ownership of vote state

- Minimal payload and query cost

- Enables clean BFF aggregation

### Cons

- Adds one additional API call for detail views

## Implementation Results

- Implemented GET /questions/:id/my-vote/ as a ViewSet action

- Vote queried directly via (user, question) constraint

- 404 used to represent ‚Äúnot voted‚Äù

- Authentication enforced

- Behavior verified via manual testing
